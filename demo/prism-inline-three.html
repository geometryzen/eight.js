<!doctype html>
<html>
  <head>
    <title>THREE Demo</title>
    <!-- Don't use webgl-debug.js outside of development. -->
    <script src="../manual-deps/khronos/webgl-debug.js"></script>
    <script src="../vendor/gl-matrix/dist/gl-matrix.js"></script>
    <script src="../vendor/threejs/build/three.js"></script>
    <script src="../vendor/stats.js/build/stats.min.js"></script>
    <script src="../dist/eight.js"></script>
    <script>
      function initWebGL()
      {
        var canvas = document.getElementById("my-canvas");
        if (typeof WebGLDebugUtils !== 'undefined')
        {
          canvas = WebGLDebugUtils.makeLostContextSimulatingCanvas(canvas);
          //canvas.loseContextInNCalls(1000);
          //canvas.setRestoreTimeout(3000);
        }
        var scene = new THREE.Scene();
        var renderer = new THREE.WebGLRenderer({'canvas': canvas});
        renderer.setClearColor(new THREE.Color(0x080808),1);
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );

        var stats = new Stats();
        stats.setMode(0);
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.left = '0px';
        stats.domElement.style.top = '0px';
        document.body.appendChild(stats.domElement);

        var tick = function(time)
        {
          stats.begin();
//        mesh.rotation.x += 0.1;
          mesh.rotation.y += 0.1;
          renderer.render(scene, camera);
          stats.end();
        };
        var terminate = function(time)
        {
          return false;
        };
        var setUp = function()
        {
          monitor.start();
        };

        var tearDown = function()
        {
          monitor.stop();
        };

        var runner = new EIGHT.WindowAnimationRunner(tick, terminate, setUp, tearDown, window);
        var camera = new THREE.PerspectiveCamera(45, canvas.width / canvas.height, 0.1, 100.0);
        camera.position.z = 5;

        var mesh = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshNormalMaterial({'wireframe':true}));
        scene.add(mesh);

        var onContextLoss = function()
        {
          runner.stop();
        };

        var onContextGain = function(gl)
        {
//        initWebGL();
        };

        var monitor = new EIGHT.WebGLContextMonitor(canvas, onContextLoss, onContextGain);

        var gl = canvas.getContext('webgl');
        if (typeof WebGLDebugUtils !== 'undefined')
        {
          var logGLCall = function(functionName, args)
          {
             console.log("gl." + functionName + "(" + WebGLDebugUtils.glFunctionArgsToString(functionName, args) + ")");
          }
          function validateNoneOfTheArgsAreUndefined(functionName, args)
          {
            for (var ii = 0; ii < args.length; ++ii)
            {
              if (args[ii] === undefined)
              {
                console.error("undefined passed to gl." + functionName + "(" + WebGLDebugUtils.glFunctionArgsToString(functionName, args) + ")");
              }
            }
          }
          function onGLCall(functionName, args)
          {
             logGLCall(functionName, args);
             validateNoneOfTheArgsAreUndefined(functionName, args);
          }
          gl = WebGLDebugUtils.makeDebugContext(gl, undefined, onGLCall);
        }
        runner.start();
      }
    </script>
  </head>
  <body onload="initWebGL()">
    <canvas id="my-canvas" width="800" height="600">
      Your browser does not support the HTML5 canvas element.
    </canvas>
  </body>
</html>
