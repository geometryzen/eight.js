<!doctype html>
<html>
  <head>
    <title>Eight Demo</title>
    <!-- Don't use webgl-debug.js outside of development. -->
    <!--script src="../manual-deps/khronos/webgl-debug.js"></script-->
    <script src="../vendor/gl-matrix/dist/gl-matrix.js"></script>
    <script src="../dist/eight.js"></script>
    <script src="../vendor/stats.js/build/stats.min.js"></script>
    <script>
      function initWebGL()
      {
        var canvas = document.getElementById("my-canvas");
        if (typeof WebGLDebugUtils !== 'undefined')
        {
          canvas = WebGLDebugUtils.makeLostContextSimulatingCanvas(canvas);
          // canvas.loseContextInNCalls(1000);
          // canvas.setRestoreTimeout(3000);
        }
        var scene = new EIGHT.Scene();
        var renderer = new EIGHT.WebGLRenderer();

        var stats = new Stats();
        stats.setMode(0);
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.left = '0px';
        stats.domElement.style.top = '0px';
        document.body.appendChild(stats.domElement);

        var tick = function(time)
        {
          stats.begin();
          renderer.render(scene, camera);
          stats.end();
        };
        var terminate = function(time)
        {
          return false;
        };
        var setUp = function()
        {
          monitor.start();
        };

        var tearDown = function()
        {
          monitor.stop();
          scene.tearDown();
        };

        var animation = new EIGHT.WindowAnimationRunner(tick, terminate, setUp, tearDown, window);
        var camera = new EIGHT.PerspectiveCamera(45, canvas.width / canvas.height, 0.1, 100.0);

        var mesh = new EIGHT.Mesh(new EIGHT.PrismGeometry());
        scene.add(mesh);

        var onContextLoss = function()
        {
          animation.stop();
          renderer.onContextLoss();
          scene.onContextLoss();
        };

        var onContextGain = function(gl)
        {
          scene.onContextGain(gl);
          renderer.onContextGain(gl);
          animation.start();
        };

        var monitor = new EIGHT.WebGLContextMonitor(canvas, onContextLoss, onContextGain);

        var gl = canvas.getContext('webgl');
        if (typeof WebGLDebugUtils !== 'undefined')
        {
          var logGLCall = function(functionName, args)
          {
             console.log("gl." + functionName + "(" + WebGLDebugUtils.glFunctionArgsToString(functionName, args) + ")");
          }
          function validateNoneOfTheArgsAreUndefined(functionName, args)
          {
            for (var ii = 0; ii < args.length; ++ii)
            {
              if (args[ii] === undefined)
              {
                console.error("undefined passed to gl." + functionName + "(" + WebGLDebugUtils.glFunctionArgsToString(functionName, args) + ")");
              }
            }
          }
          function onGLCall(functionName, args)
          {
             logGLCall(functionName, args);
             validateNoneOfTheArgsAreUndefined(functionName, args);
          }
          gl = WebGLDebugUtils.makeDebugContext(gl, undefined, onGLCall);
        }
        onContextGain(gl);
      }
    </script>
  </head>
  <body onload="initWebGL()">
    <canvas id="my-canvas" width="800" height="600">
      Your browser does not support the HTML5 canvas element.
    </canvas>
  </body>
</html>
